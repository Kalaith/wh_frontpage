RewriteEngine On

# Set the base path for this frontpage directory
RewriteBase /frontpage/

# Route API requests to backend public front controller when present
RewriteCond %{REQUEST_URI} ^/frontpage/api/
RewriteCond %{DOCUMENT_ROOT}/frontpage/backend/public/index.php -f
RewriteRule ^api/(.*)$ backend/public/index.php [QSA,L]

RewriteCond %{REQUEST_URI} ^/frontpage/api/
RewriteCond %{DOCUMENT_ROOT}/frontpage/api/public/index.php -f
RewriteRule ^api/(.*)$ api/public/index.php [QSA,L]

# If the requested file or directory exists, serve it directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Exclude backend and api paths from SPA rewrite
RewriteCond %{REQUEST_URI} !^/frontpage/backend/
RewriteCond %{REQUEST_URI} !^/frontpage/api/

# For everything else under /frontpage, serve index.html (client-side routing)
RewriteRule ^ index.html [L]
